## 函数式编程语言和函数式编程，未来会兴盛还是凋亡？

#### 什么是函数式编程语言？最早的函数式编程是怎么样的？
  函数式编程的理论基石是Lambda演算  ，二十世纪三十年代图灵的老师Alonzo Church提出了lambda演算，目的是以一种通用的形式化方式来表示复杂的计算过程。之后出现了LISP，它是基于lambda演算的高级计算机程序语言，Lisp在图灵机上实现了lambda演算。
  计算机的诞生之初就是为了解决计算问题，尤其是数学上的一些复杂问题的计算，因此解决数学问题的函数式思想在最早期的计算机程序中就包含了。
   函数式编程是一种编程范式，也就是便携程序的方法论。它属于结构化编程的一种，它的主要思想是把运算过程尽量写成一系列嵌套的函数调用。
   函数式编程中的函数与其他数据类型一样，处于平等地位，可以赋值给其他变量，也可以作为参数传入另一个函数，或者作为别的函数的返回值；只用“表达式”，不用“语句”。表达式是一个单纯的运算过程，有返回值，而语句是执行某种操作，没有返回值。函数式编程要求只使用表达式，不使用语句，因为函数式一开始就是为了处理运算，不考虑系统对I/O，但是考虑到实际应用中不做I/O是不现实的，现在的函数式编程要求把I/O限制到最小，减少不必要的读写，保持计算过程的单纯性；强调函数内部不与外部互动，函数要保持独立，所有功能都是返回一个新的值，没有其他行为，尤其是不能修改外部变量的值；引用透明，函数的运行不依赖于外部变量或“状态”，只依赖于输入的参数，任何时候只要参数相同，引用函数所得到的返回值总是相同的。

#### 为什么早期的函数式编程都没有被广泛运用？
  冯诺伊曼的体系结构渐渐强大，而函数式编程却不被人们广泛运用，无论是LISP、Scheme还是90年代出现的Haskell都没有被看好，而它们一般被用作数学、形式逻辑方面的研究使用。
  - 函数式编程的设计上较为复杂，学习的门槛比较高，在函数式语言里渗透着各种数学知识，甚至有些概念比数学中的还复杂。
  - 函数式语言的执行效率并没有优势，而且对CPU和存储器资源占用较高，尤其在对没有递归进行优化的编译器中，在机器上的执行性能并不高。虽然纯函数式编程在理论上并行概念很好，但是在实践中性能不足，但是使用并行就是为了提高性能，这与我们的想法相矛盾。

#### 函数式编程的好处是什么？
  - 代码简单，开发速度快：函数式编程使用的函数多，大大降低了代码的重复率，因此程序代码量少，开发速度快。同样功能的程序，极端情况下，Lisp代码的长度可能是C代码的二十分之一。在高度竞争的市场环境下，开发速度差一点就会处在落后的位置。
  - 理解难度低，接近自然语言和人的思维方式：函数式编程的自由度很高，可以写出很接近自然语言的代码，因此更容易被人理解。
  - 方便的代码管理：函数式编程不依赖，也不改变外界的状态，只要给定输入的参数，返回的结果一定是相同的。因此每个函数都可以被看作独立单元，很有利于进行单元测试和Debug以及模块化组合。
  - 善于“并发“：函数式编程不需要考虑死锁，因为它不修改变量，所以不用担心一个线程的数据被另一个线程所修改，所以可以把工作分摊到多个线程，即”并发“。CPU多核会让函数式编程的这个特点大放异彩。


#### 现在的函数式编程语言是怎么样的？
  ##### **热门的编程语言添加了对函数式编程语言的支持**。
   **JVM上支持的语言：Kotlin、Scala、Clojure**
  - **Kotlin**是一种基于JVM的静态类型编程语言。他拥有JAVA的完整生态（JVM），又有现代语言的语法糖。kotlin极具实用主义和极简主义，语法简单优雅而注重工程的实践性；kotlin可以防范空指针异常。最重要的是它有着多范式、高阶函数和闭包：Kotlin同时支持OOP与FP编程范式，我们可以把函数当成值来传递各种编程风格的组合可以让我们更好的直接表达算法思想和解决问题，给予工程师更大的自由度和灵活性。而Scala有很多类似的函数式编程特性，Scala广泛用于大数据和云计算，Scala既有面向对象组织项目工程的能力，又有计算数据的功能；Spark是近年来发展较快的分布式并行数据处理框架，它是由Scala开发的，因为它的函数式编程特性，使得它实现算法非常简洁优雅。

  - **Clojure**：Clojure是一门Lisp的方言，是一门“接地气”的函数式编程语言，因为它运行在JVM这个成功而应用广泛的平台上，能和java代码兼容，运用jvm上的各种资源。它鼓励纯函数、极简的语法，相比于为了支持多范式而引入复杂度的C++和Scala，Clojure只能说是有部分OO特性。Clojure的语法相对Scheme来说要复杂很多，但是比Common Lisp还是要精简了不少，它的语法设计比较稳定。当然，基于JVM也会给它带来一些坏处，比如启动速度太慢，不适合写小的脚本，而且若想精通Clojure，必须要学好Java，这从一定程度上提高了学习成本。

  - **Java与C++**：JAVA在java8版本最大的变化是引入了Lambda表达式和Stream，在Java8出现以前，人们关注的往往是某一类对象应该具有什么样的属性，就是对数据进行抽象；在java8出现以后，更加关注是某一类共有的行为（类似接口）。而增加Lambda表达式的目的就是面对大型数据集合的时候，为了能够更高效的开发，便携的代码更易于维护，更容易运行在多核CPU上。而C++在C++11/14的新特性（lambda表达式）可以让我们实现高阶函数、链式调用、惰性求值和柯里化。

  - **Haskell**：Haskell是现有的一门开放的、已发布标准的，且有多种实现的语言。支持惰性求值、模式匹配、列表解析、类型类和类型多态。它是一门函数式编程语言，这意味着Haskell中的函数没有副作用。Haskell用特定的类型来表达副作用，该类型与函数类型相互独立。纯函数可以操作并返回可执行的副作用的类型，但不能够执行它们，只有用于表达副作用的类型才能执行这些副作用，Haskell以此表达其它语言中的非纯函数。Haskell拥有一个基于Hindley-Milner的静态、强类型系统。
#### 未来函数式编程会怎么样？·
 - **资源**： 函数式编程具有不可变性，没有可变的状态，函数就是引用透明的和没有副作用的。函数即不依赖外部的状态，也不修改外部的状态，这样写的代码容易进行推理，不容易出错，这让单元测试和调试都容易很多，也不会造成资源争用，就不需要锁来保护可变状态，不会出现死锁。在对称多处理器（SMP）架构下能够更好的利用多个处理器（核）提供的并行处理能力。未来为什么函数式编程会越来越普及，最主要的原因还是摩尔定律的逐渐失效，计算机的发展道路趋向于多核CPU和分布式的方向，未来是大数据的时代，函数式编程只会越来越重要。2005年以来，计算机计算能力的增长已经不依赖于CPU主频的增长，而是依赖CPU核数的增多，在多核或多处理器下的程序设计是很困难的，难点在于共享的可变状态，而函数式就可以解决这个问题。
```
摩尔定律：1965年，英特尔公司创始人戈登·摩尔提出，在至多10年内，集成电路的集成度会每两年翻一番，即摩尔定律。后来这个周期被缩短到了18个月。也就是说，每隔18个月，计算机等IT产品的性能就会翻一番；或者说相同性能的计算机等IT产品，每18个月价钱会降一半。几十年来IT行业的发展始终遵循着摩尔定律预测的速度。
```

 - **深度学习**: 函数式语言在深度学习领域应用很广泛，因为函数式与深度学习模型的契合度很高。深度学习是机器学习中基于人工神经网络模型的一个分支，通过模拟多层神经元的自编码神经网络，将特征逐步抽象化，这需要多维度、大数据量的输入。TensorFlow和PyTorch是比较著名的Python深度学习框架，然而在生产环境中，基于性能和安全性的考虑，一般会使用函数式语言Clojure或者Haskell。深度学习的计算模型本质上是数学模型，而数学模型本质上和函数式编程思路是一致的，数据不可变且函数间可以任意组合。这意味着使用函数式编程语言可以更好的表达深度学习的计算过程，因此更容易理解和维护，同时函数式语言内置的immutable数据结构也保障了并发的安全性。
    1. Clojure可以在两个同时修改统一引用的程序并发运行时，自动重试中间的一个，而不需要手动加锁；并行效率高；可以链式调用函数；具备计算安全性，计算过程不会修改已有的数据，因此在神经网络的任一层的原始值都会保留，每层计算都可以独立运行且函数永远幂等。
    2. Haskell也有独特的优势，比如类型推断和惰性求值，更适合用于机器学习。下例：x和y分别是1,2,3,4...和2,4,6,8...的无限数组，而zip函数把它们整合成一个新的无限数组(1,2),(2,4),(3,6)...，如果将zip函数执行完那么程序就会永远执行下去，但是Haskell不会进入死循环，而是输出第一位数字1。这就是惰性计算的特性，无论数组有多长，只有真正用到某项时才对其进行计算，所以哪怕初始数据量或运算量很大，实际消耗的运算资源只取决于这次计算实际用到的部分。由于深度学习的数据量巨大，惰性求值这种特性可以忽略大量的数据输入，从而提升计算性能。
``` haskell
let x = [1..]
let y = [2,4 ..]
head (tail tail( (zip x y)))
```
 - **大数据与云计算**：自从Hadoop的MR框架出现之后，大数据便快速的占据了数据处理的主战场，随后Storm流式框架和Spark批量引擎的出现（Storm由Clojure开发，Spark由Scala开发），让函数式编程大放异彩。MR框架中最常用的两个词Map和Reduce，就是函数式最基本的功能。Map是单行处理数据，如果需要跨行操作，则需要进行reduce处理，所以MapReduce就是先逐行处理，然后进行跨行处理。我们可以看到在大数据这个领域里，函数式编程已经占据了很大的比重。
 - **大型项目开发**：前文提到硬件技术的不断发展和大数据/云计算的普及，计算机的计算能力越来越强，并行计算能力也更强了，软件本身要解决的问题也越来越复杂，开发大型软件的难度也随之提高，如果要分而治之的话，就可以有各种编程范式，底层编程语言的支持也越来越重要，这些都需要函数式编程的这种抽象能力。一个大的项目可以分成多个模块/子系统，如果要让不同的编程范式融合到一起，需要松耦合，而现在技术的发展和Http协议的广泛推广，各个子系统之间走http协议接口很方便。函数式编程可以做成无状态的模式，便于组合重用，可以说函数式编程在大型项目开发中也是必不可少的一种编程范式。

#### 总结
   目前的编程环境中，多数工作是不需要用到函数式编程的，而且大多数应用程序还是不够复杂的，使用普通的面向对象编程方式就可以解决。但我认为函数式编程将来必将会成为一种趋势，我们已经明显的能够看出来主流语言也开始引入函数式特性，但是或许流行的是“非纯正的函数式语言”，换言之，函数式编程思想一定会越来越渗透到我们未来的程序中。像Scala、Kotlin这种基于JVM的多范式编程语言会比纯函数式语言更流行，当然可能在比较简单的程序中我们更偏向于OO，而在大数据/云计算等复杂程序中更倾心于FP。

#### 参考资料
- 《The Beauty of Functional Languages in Deep Learning — Clojure and Haskell》https://www.welcometothejungle.com/fr/articles/btc-deep-learning-clojure-haskell
- http://clojure-china.org/
- https://www.scala-lang.org/
- https://www.haskell.org/
- https://www.kotlincn.net/
- http://developer.51cto.com/art/200906/132568.htm 
-  《MR计算框架学习笔记》 https://my.oschina.net/u/3862440/blog/2222462

